webpackJsonp([20],{B2b9:function(t,e){},aSAZ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("BO1k"),i=a.n(s),o=a("XLwt"),n={name:"TopologyView",data:function(){return{backgroundColor:"#b2c8e2",chart:null,nodes:[],links:[],option:{}}},mounted:function(){this.initTopology(),this.renderChart()},created:function(){this.loadNodeData()},methods:{initTopology:function(){this.chart&&this.chart.dispose(),this.chart=o.init(this.$refs.topologyChart)},loadNodeData:function(){var t=this;this.$http.get("/sqlrest/manager/api/v1/node/topology").then(function(e){if(0===e.data.code){var a=[],s=[],o=[],n=!0,r=!1,d=void 0;try{for(var l,c=i()(e.data.data);!(n=(l=c.next()).done);n=!0){var h=l.value;h.serviceId.includes("MANAGER")?a.push({id:h.instanceId,name:h.host+":"+h.port,role:"Manager",address:h.host,port:h.port,memory:65|h.memory,cpu:33|h.cpu,disk:20|h.disk,status:"normal"|h.status}):h.serviceId.includes("GATEWAY")?s.push({id:h.instanceId,name:h.host+":"+h.port,role:"Gateway",address:h.host,port:h.port,memory:35|h.memory,cpu:53|h.cpu,disk:30|h.disk,status:"normal"|h.status}):h.serviceId.includes("EXECUTOR")&&o.push({id:h.instanceId,name:h.host+":"+h.port,role:"Executor",address:h.host,port:h.port,memory:25|h.memory,cpu:13|h.cpu,disk:20|h.disk,status:"normal"|h.status})}}catch(t){r=!0,d=t}finally{try{!n&&c.return&&c.return()}finally{if(r)throw d}}t.nodes=[].concat(a,s,o),t.links=[],s.forEach(function(e){o.forEach(function(a){t.links.push({source:e.id,target:a.id})})})}else alert("Failed to load data: "+e.data.message)})},renderChart:function(){var t=this,e=this.calculatePositions(),a=this.nodes.map(function(t){var a="#409EFF";return"Gateway"===t.role&&(a="#10b981"),"Executor"===t.role&&(a="#f59e0b"),"Manager"===t.role&&(a="#3b82f6"),{id:t.id,name:t.name+"\n"+t.address+"\nMem: "+t.memory+"% | CPU: "+t.cpu+"% | Disk: "+t.disk+"%",x:e[t.id].x,y:e[t.id].y,value:""+t.address,port:""+t.port,symbolSize:"Manager"===t.role?100:90,itemStyle:{color:a,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"inside",formatter:t.name,fontSize:12,fontWeight:"bold",color:"#fff"},emphasis:{itemStyle:{borderWidth:4,shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}});this.option={backgroundColor:this.backgroundColor,title:{text:"",subtext:"",top:"10",left:"center"},tooltip:{trigger:"item",formatter:function(t){if("edge"===t.dataType)return t.data.source+" â†’ "+t.data.target;var e=t.data;return'\n              <div style="padding: 10px;">\n                <div><strong>'+e.name.split("\n")[0]+"</strong></div>\n                <div>Address: "+e.value+"</div>\n                <div>Port: "+e.port+"</div>\n                <div>Memory Usage: "+e.name.split("Mem: ")[1].split(" | ")[0]+"</div>\n                <div>CPU Usage: "+e.name.split("CPU: ")[1].split(" | ")[0]+"</div>\n                <div>Disk Usage: "+e.name.split("Disk: ")[1].split("%")[0]+"%</div>\n              </div>\n            "}},series:[{type:"graph",layout:"none",symbol:"roundRect",roam:!0,edgeSymbol:["none","arrow"],edgeSymbolSize:[80,45],edgeLabel:{show:!0},data:a,links:this.links,lineStyle:{color:"#999",opacity:.6,width:3,curveness:0},emphasis:{focus:"adjacency",lineStyle:{width:5,color:"#333"}}}]},this.chart.setOption(this.option),window.addEventListener("resize",function(){t.chart.resize()})},calculatePositions:function(){var t={},e=this.$refs.topologyChart.clientWidth||800,a=this.$refs.topologyChart.clientHeight||300,s=this.nodes.find(function(t){return"Manager"===t.role}),i=this.nodes.filter(function(t){return"Gateway"===t.role}),o=this.nodes.filter(function(t){return"Executor"===t.role});if(s&&(t[s.id]={x:e/2,y:.01*a}),i.length>0){var n=e/(i.length+1);i.forEach(function(e,s){t[e.id]={x:n*(s+1),y:.1*a}})}if(o.length>0){var r=e/(o.length+1);o.forEach(function(e,s){t[e.id]={x:r*(s+1),y:.25*a}})}return t},updateNodeData:function(){this.loadNodeData(),this.nodes.forEach(function(t){t.memory=Math.min(100,Math.max(0,t.memory+10*(Math.random()-.5))),t.cpu=Math.min(100,Math.max(0,t.cpu+10*(Math.random()-.5))),t.disk=Math.min(100,Math.max(0,t.disk+2*(Math.random()-.5))),Math.random()>.8&&(t.status=Math.random()>.2?"normal":"warning")}),this.renderChart()},refreshData:function(){this.updateNodeData(),this.$message({message:"Data refreshed",type:"success",duration:1e3})}},beforeDestroy:function(){this.chart&&this.chart.dispose()}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h1",{staticClass:"page-title"},[t._v("TOPOLOGY")]),t._v(" "),a("div",{staticClass:"topology-container",style:{backgroundColor:t.backgroundColor}},[a("div",{staticClass:"header"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("button",{staticClass:"refresh-btn",on:{click:t.refreshData}},[t._v("Refresh")])]),t._v(" "),a("div",{staticClass:"topology-content"},[a("div",{ref:"topologyChart",attrs:{id:"topology-chart"}})])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color manager-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Manager")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("API Management Node")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color gateway-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Gateway")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("API Gateway Node")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color executor-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Executor")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("API Execution Node")])])])}]};var d=a("VU/8")(n,r,!1,function(t){a("B2b9")},"data-v-457487ac",null);e.default=d.exports}});
//# sourceMappingURL=20.002184a729ecb37a60eb.js.map