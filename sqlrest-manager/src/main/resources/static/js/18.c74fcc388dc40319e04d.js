webpackJsonp([18],{"3y0S":function(e,t){},"6PtB":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("BO1k"),l=a.n(i),o=a("mvHQ"),n=a.n(o),s={data:function(){return{loading:!0,currentPage:1,pageSize:10,totalCount:2,keyword:null,groupId:null,moduleId:null,online:!1,open:null,apiDocStatus:!0,groupLists:[],moduleLists:[],tableData:[],publishDialogVisible:!1,publishVersionDesc:"",versionDialogVisible:!1,selectRowId:0,selectCommitId:0,versions:[],openApiDocs:[{key:"swagger"},{key:"knife4j"}],selectOpenApiDocsDialogVisible:!1,selectedOpenApiDocType:"swagger",isSelected:!0,idsSelected:[],uploadAssignmentPath:"/sqlrest/manager/api/v1/assignment/import"}},methods:{handleClose:function(e){},loadData:function(){var e=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/list",data:window.JSON.stringify({groupId:this.groupId,moduleId:this.moduleId,online:this.online,open:this.open,searchText:this.keyword,page:this.currentPage,size:this.pageSize})}).then(function(t){0===t.data.code?(e.currentPage=t.data.pagination.page,e.pageSize=t.data.pagination.size,e.totalCount=t.data.pagination.total,e.tableData=t.data.data):alert("Failed to load list: "+t.data.message)})},loadGroupList:function(){var e=this;this.groupLists=[],this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/group/listAll",data:n()({page:1,size:2147483647,searchText:null})}).then(function(t){0===t.data.code?e.groupLists=t.data.data:alert("Failed to load: "+t.data.message)})},loadModuleList:function(){var e=this;this.moduleLists=[],this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/module/listAll",data:n()({page:1,size:2147483647,searchText:null})}).then(function(t){0===t.data.code?e.moduleLists=t.data.data:alert("Failed to load: "+t.data.message)})},loadApiDocOpenStatus:function(){var e=this;this.$http.get("/sqlrest/manager/api/v1/param/value/query?key=apiDocOpen").then(function(t){0===t.data.code?e.apiDocStatus=t.data.data:t.data.message&&alert("Operation failed: "+t.data.message)})},searchByKeyword:function(){this.currentPage=1,this.loadData()},hanldeSwitchApiDoc:function(){var e=this;this.$http.post("/sqlrest/manager/api/v1/param/value/update?key=apiDocOpen&value="+this.apiDocStatus).then(function(t){0===t.data.code?e.loadApiDocOpenStatus():t.data.message&&alert("Operation failed: "+t.data.message)})},boolFormatPublish:function(e){return!0===e.status?"V"+e.version:"No"},boolFormatOpen:function(e){return!0===e.open?"Yes":"No"},boolFormatAlarm:function(e){return!0===e.alarm?"On":"Off"},handleSearch:function(){this.loadData()},handleCreate:function(){this.$router.push("/interface/create")},openOnlineApiDoc:function(){this.selectedOpenApiDocType=this.openApiDocs[0].key,this.selectOpenApiDocsDialogVisible=!0},handleOpenApiDoc:function(){var e=this;this.$http({method:"GET",url:"/sqlrest/manager/api/v1/node/gateway"}).then(function(t){if(0===t.data.code){if(t.data.data&&"string"==typeof t.data.data){var a=t.data.data+"/apidoc/"+e.selectedOpenApiDocType+"/index.html";window.open(a,"_blank")}}else t.data.message&&alert("Operation failed: "+t.data.message);e.selectOpenApiDocsDialogVisible=!1})},handleDetail:function(e,t){this.$router.push({path:"/interface/detail",query:{id:t.id}})},handleUpdate:function(e,t){this.$router.push({path:"/interface/update",query:{id:t.id}})},handleDelete:function(e,t){var a=this;this.$confirm("This operation will delete API ID="+t.id+", continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(function(){a.$http.delete("/sqlrest/manager/api/v1/assignment/delete/"+t.id).then(function(e){0===e.data.code?a.loadData():e.data.message&&alert("Failed to delete: "+e.data.message)})})},handlePublish:function(e,t){this.selectRowId=t.id,this.publishDialogVisible=!0},handlePublishVersion:function(){var e=this;this.publishVersionDesc?this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/publish",data:n()({id:this.selectRowId,description:this.publishVersionDesc})}).then(function(t){0===t.data.code?(e.selectRowId=null,e.publishVersionDesc=null,e.publishDialogVisible=!1,e.$message("Version published successfully")):t.data.message&&alert("Failed to publish version: "+t.data.message)}):this.$alert("Version description cannot be empty","Error",{confirmButtonText:"OK",type:"error"})},handleOnline:function(e,t){var a=this;this.$http({method:"GET",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/version/list/"+t.id}).then(function(e){0===e.data.code?(a.versions=e.data.data,a.selectRowId=t.id,a.versionDialogVisible=!0):e.data.message&&alert("Failed to get version list: "+e.data.message)})},handleDeploy:function(){var e=this;!this.selectCommitId||this.selectCommitId<=0?this.$alert("Please select a version","Error",{confirmButtonText:"OK",type:"error"}):this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/deploy/"+this.selectRowId+"?commitId="+this.selectCommitId}).then(function(t){0===t.data.code?(e.selectRowId=null,e.selectCommitId=null,e.versionDialogVisible=!1,e.$message("Deployed successfully"),e.loadData()):t.data.message&&alert("Failed to deploy: "+t.data.message)})},handleOffline:function(e,t){var a=this;this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/retire/"+t.id}).then(function(e){0===e.data.code?(a.$message("Retired successfully"),a.loadData()):e.data.message&&alert("Failed to retire: "+e.data.message)})},handleSelectionChange:function(e){if(e.length>0){this.isSelected=!1;var t=!0,a=!1,i=void 0;try{for(var o,n=l()(e);!(t=(o=n.next()).done);t=!0){var s=o.value;this.idsSelected.includes(s.id)||this.idsSelected.push(s.id)}}catch(e){a=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw i}}}else this.isSelected=!0,this.idsSelected=[]},handleBatchExport:function(){var e=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/export",data:n()(this.idsSelected),responseType:"blob"}).then(function(t){var a=t.headers["content-type"];if(!t.data)return console.error("Response error: ",t),!1;var i=new Blob([t.data],{type:a});e.downloadFile(i,"sqlrest_interfaces.json")})},downloadFile:function(e,t){if("download"in document.createElement("a")){var a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a)}else window.navigator.msSaveBlob(e,t)},handleFileUpload:function(e){var t=this,a=new FormData;a.append("file",e.file),this.$http({method:"POST",headers:{"Content-Type":"multipart/form-data"},url:"/sqlrest/manager/api/v1/assignment/import",data:a}).then(function(e){0===e.data.code?(t.$message.success("Import successful"),t.loadData()):e.data.message&&t.$alert("Import failed: "+e.data.message,"Error",{confirmButtonText:"OK",type:"error"})}).catch(function(e){t.$message.error("Import failed: "+e)})},handleSizeChange:function(e){this.loading=!0,this.pageSize=e,this.loadData()},handleCurrentChange:function(e){this.loading=!0,this.currentPage=e,this.loadData()}},created:function(){this.loadGroupList(),this.loadModuleList(),this.loadApiDocOpenStatus(),this.loadData()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h1",{staticClass:"page-title"},[e._v("API CONFIG")]),e._v(" "),a("el-card",[a("div",{staticClass:"assignment-list-top"},[a("div",{staticClass:"left-search-input-group"},[a("div",{staticClass:"left-search-input"},[a("el-radio-group",{attrs:{size:"small"},on:{change:e.handleSearch},model:{value:e.online,callback:function(t){e.online=t},expression:"online"}},[a("el-radio-button",{attrs:{label:!1}},[e._v("In Development")]),e._v(" "),a("el-radio-button",{attrs:{label:!0}},[e._v("Online")])],1),e._v(" "),a("el-select",{staticStyle:{width:"15%"},attrs:{size:"small",clearable:!0,placeholder:"Select Authorization Group"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupLists,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-select",{staticStyle:{width:"15%"},attrs:{size:"small",clearable:!0,placeholder:"Please select module"},model:{value:e.moduleId,callback:function(t){e.moduleId=t},expression:"moduleId"}},e._l(e.moduleLists,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-select",{staticStyle:{width:"10%"},attrs:{size:"small",clearable:!0,placeholder:"Public"},model:{value:e.open,callback:function(t){e.open=t},expression:"open"}},[a("el-option",{key:!0,attrs:{label:"Yes",value:!0}}),e._v(" "),a("el-option",{key:!1,attrs:{label:"No",value:!1}})],1),e._v(" "),a("el-input",{staticStyle:{width:"15%"},attrs:{placeholder:"Name search",size:"small",clearable:!0},on:{change:e.searchByKeyword},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleSearch}},[e._v("Search")]),e._v(" "),e.online?a("el-switch",{attrs:{name:"Swagger Documentation Switch","active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1,"active-text":"Doc On","inactive-text":"Doc Off"},on:{change:function(t){return e.hanldeSwitchApiDoc()}},model:{value:e.apiDocStatus,callback:function(t){e.apiDocStatus=t},expression:"apiDocStatus"}}):e._e()],1)]),e._v(" "),a("div",{staticClass:"right-add-button-group"},[a("el-button",{attrs:{type:"warning",size:"small",disabled:e.isSelected,plain:"",icon:"el-icon-download"},on:{click:e.handleBatchExport}},[e._v("Export APIs")]),e._v(" "),e.online?e._e():a("el-upload",{attrs:{action:e.uploadAssignmentPath,accept:"application/json","http-request":e.handleFileUpload,multiple:!1,"show-file-list":!1,"auto-upload":!0}},[e.online?e._e():a("el-button",{attrs:{type:"warning",size:"small",plain:"",icon:"el-icon-upload2"}},[e._v("Import APIs")])],1),e._v(" "),e.online?a("el-button",{attrs:{type:"warning",size:"small",disabled:0==e.apiDocStatus,icon:"el-icon-document-add"},on:{click:e.openOnlineApiDoc}},[e._v("Online Documentation")]):e._e(),e._v(" "),e.online?e._e():a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleCreate}},[e._v("New API")])],1)]),e._v(" "),a("el-table",{attrs:{data:e.tableData,size:"small",border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"id",type:"selection","min-width":"8%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"8%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"Name","show-overflow-tooltip":"","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{staticClass:"btn-text",attrs:{type:"primary"},on:{click:function(a){return e.handleDetail(t.$index,t.row)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Path","show-overflow-tooltip":"","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{staticClass:"name-wrapper-tag method-tag",attrs:{size:"medium"}},[e._v(e._s(t.row.method))]),e._v("\n          "+e._s(t.row.path)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"moduleName",label:"Module","show-overflow-tooltip":"","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groupName",label:"Authorization Group","show-overflow-tooltip":"","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{label:"Engine","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{staticClass:"name-wrapper-tag method-tag",attrs:{size:"medium"}},[e._v(e._s(t.row.engine))])]}}])}),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"status",label:"Online",formatter:e.boolFormatPublish,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"open",label:"Public",formatter:e.boolFormatOpen,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"alarm",label:"Alarm",formatter:e.boolFormatAlarm,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"Create Time","min-width":"18%"}}),e._v(" "),a("el-table-column",{attrs:{label:"Actions","min-width":"25%"},scopedSlots:e._u([{key:"default",fn:function(t){return[!1===t.row.status?a("el-tooltip",{attrs:{content:"Deploy",placement:"top",effect:"dark"}},[a("el-button",{attrs:{plain:"",size:"mini",type:"primary",circle:""},on:{click:function(a){return e.handleOnline(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-timer"})])],1):e._e(),e._v(" "),!0===t.row.status?a("el-tooltip",{attrs:{content:"Retire",placement:"top",effect:"dark"}},[a("el-button",{attrs:{plain:"",size:"mini",type:"info",circle:""},on:{click:function(a){return e.handleOffline(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-delete-location"})])],1):e._e(),e._v(" "),a("el-tooltip",{attrs:{content:"Edit",placement:"top",effect:"dark"}},[a("el-button",{attrs:{plain:"",size:"mini",type:"warning",circle:""},on:{click:function(a){return e.handleUpdate(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-edit"})])],1),e._v(" "),a("el-tooltip",{attrs:{content:"Publish",placement:"top",effect:"dark"}},[a("el-button",{attrs:{plain:"",size:"mini",type:"success",circle:""},on:{click:function(a){return e.handlePublish(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-position"})])],1),e._v(" "),!1===t.row.status?a("el-tooltip",{attrs:{content:"Delete",placement:"top",effect:"dark"}},[a("el-button",{attrs:{plain:"",size:"mini",type:"danger",circle:""},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[a("i",{staticClass:"el-icon-delete"})])],1):e._e()]}}])})],1),e._v(" "),a("div",{staticClass:"page",attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10,20,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Publish New Version",visible:e.publishDialogVisible,showClose:!1,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.publishDialogVisible=t}}},[a("el-form",{attrs:{size:"mini","status-icon":""}},[a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"Version Description","label-width":"120px",required:!0}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},"auto-complete":"off"},model:{value:e.publishVersionDesc,callback:function(t){e.publishVersionDesc=t},expression:"publishVersionDesc"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.publishDialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handlePublishVersion}},[e._v("Publish")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Select Version to Deploy",visible:e.versionDialogVisible,showClose:!1,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.versionDialogVisible=t}}},[a("el-table",{attrs:{data:e.versions,"highlight-current-row":"",size:"small",border:""}},[a("template",{slot:"empty"},[a("span",[e._v('Version list is empty, please click "Publish" button to publish a version')])]),e._v(" "),a("el-table-column",{attrs:{label:"Select Version","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.commitId},model:{value:e.selectCommitId,callback:function(t){e.selectCommitId=t},expression:"selectCommitId"}},[e._v("V"+e._s(t.row.version))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"Create Time","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"Version Description","show-overflow-tooltip":"","min-width":"20%"}})],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.versionDialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleDeploy}},[e._v("Deploy")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"Please Select Online Documentation Type",visible:e.selectOpenApiDocsDialogVisible,showClose:!1,width:"20%","before-close":e.handleClose},on:{"update:visible":function(t){e.selectOpenApiDocsDialogVisible=t}}},[a("el-select",{staticStyle:{width:"95%"},attrs:{size:"mini",placeholder:"Please select documentation type"},model:{value:e.selectedOpenApiDocType,callback:function(t){e.selectedOpenApiDocType=t},expression:"selectedOpenApiDocType"}},e._l(e.openApiDocs,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.key}})}),1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.selectOpenApiDocsDialogVisible=!1}}},[e._v("Cancel")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleOpenApiDoc}},[e._v("Open")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,r,!1,function(e){a("3y0S")},"data-v-5cffe844",null);t.default=c.exports}});
//# sourceMappingURL=18.c74fcc388dc40319e04d.js.map