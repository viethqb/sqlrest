webpackJsonp([25],{aSAZ:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("BO1k"),i=s.n(a),o=s("XLwt"),n={name:"TopologyView",data:function(){return{backgroundColor:"#b2c8e2",chart:null,nodes:[],links:[],option:{}}},mounted:function(){this.initTopology(),this.renderChart()},created:function(){this.loadNodeData()},methods:{initTopology:function(){this.chart&&this.chart.dispose(),this.chart=o.init(this.$refs.topologyChart)},loadNodeData:function(){var t=this;this.$http.get("/sqlrest/manager/api/v1/node/topology").then(function(e){if(0===e.data.code){var s=[],a=[],o=[],n=!0,r=!1,d=void 0;try{for(var l,c=i()(e.data.data);!(n=(l=c.next()).done);n=!0){var h=l.value;h.serviceId.includes("MANAGER")?s.push({id:h.instanceId,name:h.host+":"+h.port,role:"Manager",address:h.host,port:h.port,memory:65|h.memory,cpu:33|h.cpu,disk:20|h.disk,status:"normal"|h.status}):h.serviceId.includes("GATEWAY")?a.push({id:h.instanceId,name:h.host+":"+h.port,role:"Gateway",address:h.host,port:h.port,memory:35|h.memory,cpu:53|h.cpu,disk:30|h.disk,status:"normal"|h.status}):h.serviceId.includes("EXECUTOR")&&o.push({id:h.instanceId,name:h.host+":"+h.port,role:"Executor",address:h.host,port:h.port,memory:25|h.memory,cpu:13|h.cpu,disk:20|h.disk,status:"normal"|h.status})}}catch(t){r=!0,d=t}finally{try{!n&&c.return&&c.return()}finally{if(r)throw d}}t.nodes=[].concat(s,a,o),t.links=[],a.forEach(function(e){o.forEach(function(s){t.links.push({source:e.id,target:s.id})})})}else alert("加载数据失败:"+e.data.message)})},renderChart:function(){var t=this,e=this.calculatePositions(),s=this.nodes.map(function(t){var s="#409EFF";return"Gateway"===t.role&&(s="#10b981"),"Executor"===t.role&&(s="#f59e0b"),"Manager"===t.role&&(s="#3b82f6"),{id:t.id,name:t.name+"\n"+t.address+"\nMem: "+t.memory+"% | CPU: "+t.cpu+"% | Disk: "+t.disk+"%",x:e[t.id].x,y:e[t.id].y,value:""+t.address,port:""+t.port,symbolSize:"Manager"===t.role?100:90,itemStyle:{color:s,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"inside",formatter:t.name,fontSize:12,fontWeight:"bold",color:"#fff"},emphasis:{itemStyle:{borderWidth:4,shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}});this.option={backgroundColor:this.backgroundColor,title:{text:"",subtext:"",top:"10",left:"center"},tooltip:{trigger:"item",formatter:function(t){if("edge"===t.dataType)return t.data.source+" → "+t.data.target;var e=t.data;return'\n              <div style="padding: 10px;">\n                <div><strong>'+e.name.split("\n")[0]+"</strong></div>\n                <div>地址: "+e.value+"</div>\n                <div>端口: "+e.port+"</div>\n                <div>内存使用率: "+e.name.split("Mem: ")[1].split(" | ")[0]+"</div>\n                <div>CPU使用率: "+e.name.split("CPU: ")[1].split(" | ")[0]+"</div>\n                <div>磁盘使用率: "+e.name.split("Disk: ")[1].split("%")[0]+"%</div>\n              </div>\n            "}},series:[{type:"graph",layout:"none",symbol:"roundRect",roam:!0,edgeSymbol:["none","arrow"],edgeSymbolSize:[80,45],edgeLabel:{show:!0},data:s,links:this.links,lineStyle:{color:"#999",opacity:.6,width:3,curveness:0},emphasis:{focus:"adjacency",lineStyle:{width:5,color:"#333"}}}]},this.chart.setOption(this.option),window.addEventListener("resize",function(){t.chart.resize()})},calculatePositions:function(){var t={},e=this.$refs.topologyChart.clientWidth||800,s=this.$refs.topologyChart.clientHeight||300,a=this.nodes.find(function(t){return"Manager"===t.role}),i=this.nodes.filter(function(t){return"Gateway"===t.role}),o=this.nodes.filter(function(t){return"Executor"===t.role});if(a&&(t[a.id]={x:e/2,y:.01*s}),i.length>0){var n=e/(i.length+1);i.forEach(function(e,a){t[e.id]={x:n*(a+1),y:.1*s}})}if(o.length>0){var r=e/(o.length+1);o.forEach(function(e,a){t[e.id]={x:r*(a+1),y:.25*s}})}return t},updateNodeData:function(){this.loadNodeData(),this.nodes.forEach(function(t){t.memory=Math.min(100,Math.max(0,t.memory+10*(Math.random()-.5))),t.cpu=Math.min(100,Math.max(0,t.cpu+10*(Math.random()-.5))),t.disk=Math.min(100,Math.max(0,t.disk+2*(Math.random()-.5))),Math.random()>.8&&(t.status=Math.random()>.2?"normal":"warning")}),this.renderChart()},refreshData:function(){this.updateNodeData(),this.$message({message:"数据已刷新",type:"success",duration:1e3})}},beforeDestroy:function(){this.chart&&this.chart.dispose()}},r={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"topology-container",style:{backgroundColor:t.backgroundColor}},[s("div",{staticClass:"header"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("button",{staticClass:"refresh-btn",on:{click:t.refreshData}},[t._v("点击刷新")])]),t._v(" "),s("div",{staticClass:"topology-content"},[s("div",{ref:"topologyChart",attrs:{id:"topology-chart"}})])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color manager-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Manager")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("接口管理节点")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color gateway-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Gateway")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("接口网关节点")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"legend-item"},[e("div",{staticClass:"legend-color executor-color"}),this._v(" "),e("div",{staticClass:"legend-info"},[e("span",{staticClass:"legend-text"},[this._v("Executor")]),this._v(" "),e("span",{staticClass:"legend-desc"},[this._v("接口执行节点")])])])}]};var d=s("VU/8")(n,r,!1,function(t){s("yJI3")},"data-v-17088faf",null);e.default=d.exports},yJI3:function(t,e){}});
//# sourceMappingURL=25.9c449fbb19bce679b3d1.js.map