webpackJsonp([20],{"6PtB":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("BO1k"),o=a.n(i),l=a("mvHQ"),n=a.n(l),s={data:function(){return{loading:!0,currentPage:1,pageSize:10,totalCount:2,keyword:null,groupId:null,moduleId:null,online:!1,open:null,apiDocStatus:!0,groupLists:[],moduleLists:[],tableData:[],publishDialogVisible:!1,publishVersionDesc:"",versionDialogVisible:!1,selectRowId:0,selectCommitId:0,versions:[],openApiDocs:[{key:"swagger"},{key:"knife4j"}],selectOpenApiDocsDialogVisible:!1,selectedOpenApiDocType:"swagger",isSelected:!0,idsSelected:[],uploadAssignmentPath:"/sqlrest/manager/api/v1/assignment/import"}},methods:{handleClose:function(e){},loadData:function(){var e=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/list",data:window.JSON.stringify({groupId:this.groupId,moduleId:this.moduleId,online:this.online,open:this.open,searchText:this.keyword,page:this.currentPage,size:this.pageSize})}).then(function(t){0===t.data.code?(e.currentPage=t.data.pagination.page,e.pageSize=t.data.pagination.size,e.totalCount=t.data.pagination.total,e.tableData=t.data.data):alert("加载列表失败:"+t.data.message)})},loadGroupList:function(){var e=this;this.groupLists=[],this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/group/listAll",data:n()({page:1,size:2147483647,searchText:null})}).then(function(t){0===t.data.code?e.groupLists=t.data.data:alert("加载失败:"+t.data.message)})},loadModuleList:function(){var e=this;this.moduleLists=[],this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/module/listAll",data:n()({page:1,size:2147483647,searchText:null})}).then(function(t){0===t.data.code?e.moduleLists=t.data.data:alert("加载失败:"+t.data.message)})},loadApiDocOpenStatus:function(){var e=this;this.$http.get("/sqlrest/manager/api/v1/param/value/query?key=apiDocOpen").then(function(t){0===t.data.code?e.apiDocStatus=t.data.data:t.data.message&&alert("操作失败:"+t.data.message)})},searchByKeyword:function(){this.currentPage=1,this.loadData()},hanldeSwitchApiDoc:function(){var e=this;this.$http.post("/sqlrest/manager/api/v1/param/value/update?key=apiDocOpen&value="+this.apiDocStatus).then(function(t){0===t.data.code?e.loadApiDocOpenStatus():t.data.message&&alert("操作失败:"+t.data.message)})},boolFormatPublish:function(e){return!0===e.status?"V"+e.version:"否"},boolFormatOpen:function(e){return!0===e.open?"是":"否"},boolFormatAlarm:function(e){return!0===e.alarm?"开":"关"},handleSearch:function(){this.loadData()},handleCreate:function(){this.$router.push("/interface/create")},openOnlineApiDoc:function(){this.selectedOpenApiDocType=this.openApiDocs[0].key,this.selectOpenApiDocsDialogVisible=!0},handleOpenApiDoc:function(){var e=this;this.$http({method:"GET",url:"/sqlrest/manager/api/v1/node/gateway"}).then(function(t){if(0===t.data.code){if(t.data.data&&"string"==typeof t.data.data){var a=t.data.data+"/apidoc/"+e.selectedOpenApiDocType+"/index.html";window.open(a,"_blank")}}else t.data.message&&alert("操作失败:"+t.data.message);e.selectOpenApiDocsDialogVisible=!1})},handleDetail:function(e,t){this.$router.push({path:"/interface/detail",query:{id:t.id}})},handleUpdate:function(e,t){this.$router.push({path:"/interface/update",query:{id:t.id}})},handleDelete:function(e,t){var a=this;this.$confirm("此操作将此接口ID="+t.id+"删除么, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.delete("/sqlrest/manager/api/v1/assignment/delete/"+t.id).then(function(e){0===e.data.code?a.loadData():e.data.message&&alert("删除失败:"+e.data.message)})})},handlePublish:function(e,t){this.selectRowId=t.id,this.publishDialogVisible=!0},handlePublishVersion:function(){var e=this;this.publishVersionDesc?this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/publish",data:n()({id:this.selectRowId,description:this.publishVersionDesc})}).then(function(t){0===t.data.code?(e.selectRowId=null,e.publishVersionDesc=null,e.publishDialogVisible=!1,e.$message("发布版本成功")):t.data.message&&alert("发布版本失败,"+t.data.message)}):this.$alert("版本描述内容不能为空","错误信息",{confirmButtonText:"确定",type:"error"})},handleOnline:function(e,t){var a=this;this.$http({method:"GET",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/version/list/"+t.id}).then(function(e){0===e.data.code?(a.versions=e.data.data,a.selectRowId=t.id,a.versionDialogVisible=!0):e.data.message&&alert("获取版本列表失败,"+e.data.message)})},handleDeploy:function(){var e=this;!this.selectCommitId||this.selectCommitId<=0?this.$alert("请选择一个版本","错误信息",{confirmButtonText:"确定",type:"error"}):this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/deploy/"+this.selectRowId+"?commitId="+this.selectCommitId}).then(function(t){0===t.data.code?(e.selectRowId=null,e.selectCommitId=null,e.versionDialogVisible=!1,e.$message("上线成功"),e.loadData()):t.data.message&&alert("上线失败,"+t.data.message)})},handleOffline:function(e,t){var a=this;this.$http({method:"PUT",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/retire/"+t.id}).then(function(e){0===e.data.code?(a.$message("下线成功"),a.loadData()):e.data.message&&alert("下线失败,"+e.data.message)})},handleSelectionChange:function(e){if(e.length>0){this.isSelected=!1;var t=!0,a=!1,i=void 0;try{for(var l,n=o()(e);!(t=(l=n.next()).done);t=!0){var s=l.value;this.idsSelected.includes(s.id)||this.idsSelected.push(s.id)}}catch(e){a=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw i}}}else this.isSelected=!0,this.idsSelected=[]},handleBatchExport:function(){var e=this;this.$http({method:"POST",headers:{"Content-Type":"application/json"},url:"/sqlrest/manager/api/v1/assignment/export",data:n()(this.idsSelected),responseType:"blob"}).then(function(t){var a=t.headers["content-type"];if(!t.data)return console.error("响应异常：",t),!1;var i=new Blob([t.data],{type:a});e.downloadFile(i,"sqlrest_interfaces.json")})},downloadFile:function(e,t){if("download"in document.createElement("a")){var a=document.createElement("a");a.href=window.URL.createObjectURL(e),a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a)}else window.navigator.msSaveBlob(e,t)},handleFileUpload:function(e){var t=this,a=new FormData;a.append("file",e.file),this.$http({method:"POST",headers:{"Content-Type":"multipart/form-data"},url:"/sqlrest/manager/api/v1/assignment/import",data:a}).then(function(e){0===e.data.code?(t.$message.success("导入成功"),t.loadData()):e.data.message&&t.$alert("导入失败,"+e.data.message,"错误信息",{confirmButtonText:"确定",type:"error"})}).catch(function(e){t.$message.error("导入失败,"+e)})},handleSizeChange:function(e){this.loading=!0,this.pageSize=e,this.loadData()},handleCurrentChange:function(e){this.loading=!0,this.currentPage=e,this.loadData()}},created:function(){this.loadGroupList(),this.loadModuleList(),this.loadApiDocOpenStatus(),this.loadData()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",[a("div",{staticClass:"assignment-list-top"},[a("div",{staticClass:"left-search-input-group"},[a("div",{staticClass:"left-search-input"},[a("el-radio-group",{attrs:{size:"small"},on:{change:e.handleSearch},model:{value:e.online,callback:function(t){e.online=t},expression:"online"}},[a("el-radio-button",{attrs:{label:!1}},[e._v("开发中")]),e._v(" "),a("el-radio-button",{attrs:{label:!0}},[e._v("已上线")])],1),e._v(" "),a("el-select",{staticStyle:{width:"15%"},attrs:{size:"mini",clearable:!0,placeholder:"选择授权分组"},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}},e._l(e.groupLists,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-select",{staticStyle:{width:"15%"},attrs:{size:"mini",clearable:!0,placeholder:"请选择模块"},model:{value:e.moduleId,callback:function(t){e.moduleId=t},expression:"moduleId"}},e._l(e.moduleLists,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-select",{staticStyle:{width:"10%"},attrs:{size:"mini",clearable:!0,placeholder:"是否公开"},model:{value:e.open,callback:function(t){e.open=t},expression:"open"}},[a("el-option",{key:!0,attrs:{label:"是",value:!0}}),e._v(" "),a("el-option",{key:!1,attrs:{label:"否",value:!1}})],1),e._v(" "),a("el-input",{staticStyle:{width:"15%"},attrs:{placeholder:"名称搜索",size:"mini",clearable:!0},on:{change:e.searchByKeyword},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),e.online?a("el-switch",{attrs:{name:"Swagger文档开关","active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1,"active-text":"文档开","inactive-text":"文档关"},on:{change:function(t){return e.hanldeSwitchApiDoc()}},model:{value:e.apiDocStatus,callback:function(t){e.apiDocStatus=t},expression:"apiDocStatus"}}):e._e()],1)]),e._v(" "),a("el-button",{attrs:{type:"warning",size:"mini",disabled:e.isSelected,plain:"",icon:"el-icon-download"},on:{click:e.handleBatchExport}},[e._v("导出接口")]),e._v(" "),e.online?e._e():a("el-upload",{attrs:{action:e.uploadAssignmentPath,accept:"application/json","http-request":e.handleFileUpload,multiple:!1,"show-file-list":!1,"auto-upload":!0}},[e.online?e._e():a("el-button",{attrs:{type:"warning",size:"mini",plain:"",icon:"el-icon-upload2"}},[e._v("导入接口")])],1),e._v(" "),e.online?a("el-button",{attrs:{type:"warning",size:"mini",disabled:0==e.apiDocStatus,icon:"el-icon-document-add"},on:{click:e.openOnlineApiDoc}},[e._v("在线文档")]):e._e(),e._v(" "),e.online?e._e():a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-document-add"},on:{click:e.handleCreate}},[e._v("新建接口")])],1),e._v(" "),a("el-table",{attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:e.tableData,size:"small",border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"id",type:"selection","min-width":"8%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"编号","min-width":"8%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":"","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{staticClass:"btn-text",attrs:{type:"primary"},on:{click:function(a){return e.handleDetail(t.$index,t.row)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"路径","show-overflow-tooltip":"","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{staticClass:"name-wrapper-tag",attrs:{size:"medium"}},[e._v(e._s(t.row.method))]),e._v("\n          "+e._s(t.row.path)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"moduleName",label:"模块","show-overflow-tooltip":"","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"groupName",label:"授权分组","show-overflow-tooltip":"","min-width":"10%"}}),e._v(" "),a("el-table-column",{attrs:{label:"引擎","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{staticClass:"name-wrapper-tag",attrs:{size:"medium"}},[e._v(e._s(t.row.engine))])]}}])}),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"status",label:"上线",formatter:e.boolFormatPublish,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"open",label:"公开",formatter:e.boolFormatOpen,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),e.online?a("el-table-column",{attrs:{prop:"alarm",label:"告警",formatter:e.boolFormatAlarm,"show-overflow-tooltip":"","min-width":"8%"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"18%"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"40%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button-group",[!1===t.row.status?a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-timer",round:""},on:{click:function(a){return e.handleOnline(t.$index,t.row)}}},[e._v("上线")]):e._e(),e._v(" "),!0===t.row.status?a("el-button",{attrs:{size:"small",type:"info",icon:"el-icon-delete-location",round:""},on:{click:function(a){return e.handleOffline(t.$index,t.row)}}},[e._v("下线")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit",round:""},on:{click:function(a){return e.handleUpdate(t.$index,t.row)}}},[e._v("修改")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-position",round:""},on:{click:function(a){return e.handlePublish(t.$index,t.row)}}},[e._v("发版")]),e._v(" "),!1===t.row.status?a("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete",round:""},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")]):e._e()],1)]}}])})],1),e._v(" "),a("div",{staticClass:"page",attrs:{align:"right"}},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10,20,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"发布新版本",visible:e.publishDialogVisible,showClose:!1,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.publishDialogVisible=t}}},[a("el-form",{attrs:{size:"mini","status-icon":""}},[a("el-form-item",{staticStyle:{width:"85%"},attrs:{label:"版本描述","label-width":"120px",required:!0}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},"auto-complete":"off"},model:{value:e.publishVersionDesc,callback:function(t){e.publishVersionDesc=t},expression:"publishVersionDesc"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.publishDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handlePublishVersion}},[e._v("发 布")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择上线版本",visible:e.versionDialogVisible,showClose:!1,width:"40%","before-close":e.handleClose},on:{"update:visible":function(t){e.versionDialogVisible=t}}},[a("el-table",{attrs:{"header-cell-style":{background:"#eef1f6",color:"#606266"},data:e.versions,"highlight-current-row":"",size:"mini",border:""}},[a("template",{slot:"empty"},[a("span",[e._v("版本内容为空，请点击“发版”按钮发布一个版本来")])]),e._v(" "),a("el-table-column",{attrs:{label:"选择版本","min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.commitId},model:{value:e.selectCommitId,callback:function(t){e.selectCommitId=t},expression:"selectCommitId"}},[e._v("V"+e._s(t.row.version))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"生成时间","min-width":"15%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",label:"版本描述","show-overflow-tooltip":"","min-width":"20%"}})],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.versionDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleDeploy}},[e._v("上 线")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"请选择打开的在线文档类型",visible:e.selectOpenApiDocsDialogVisible,showClose:!1,width:"20%","before-close":e.handleClose},on:{"update:visible":function(t){e.selectOpenApiDocsDialogVisible=t}}},[a("el-select",{staticStyle:{width:"95%"},attrs:{size:"mini",placeholder:"请选择文档类型"},model:{value:e.selectedOpenApiDocType,callback:function(t){e.selectedOpenApiDocType=t},expression:"selectedOpenApiDocType"}},e._l(e.openApiDocs,function(e,t){return a("el-option",{key:t,attrs:{label:e.key,value:e.key}})}),1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.selectOpenApiDocsDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleOpenApiDoc}},[e._v("打 开")])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(s,r,!1,function(e){a("z5at")},"data-v-2c14a6ec",null);t.default=c.exports},z5at:function(e,t){}});
//# sourceMappingURL=20.58f58b3b2e8d01a454e6.js.map